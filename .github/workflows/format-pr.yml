name: Format PR Files

on:
  pull_request:
    types:
      - opened
    paths:
      - '**/*.md'  # Trigger workflow only when .md files are modified in the PR

jobs:
  whitespace:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Git config
        run: |
          git config --global user.name "miyaliu666"
          git config --global user.email "miyaliu66666@gmail.com"

      - name: Remove trailing whitespaces from Markdown files
        run: |
          echo "Target branch: ${{ github.event.pull_request.base.ref }}"
          echo "Head branch: ${{ github.event.pull_request.head.ref }}"

          # 获取 PR 创建者的 GitHub 用户名
          pr_creator="${{ github.event.pull_request.user.login }}"

          # 添加 PR 创建者仓库作为远程源
          git remote add $pr_creator https://github.com/$pr_creator/freecodecamp.git
          git fetch $pr_creator

          # 获取 PR 的 head 分支
          head_branch="${{ github.event.pull_request.head.ref }}"
          git checkout $head_branch

          # 获取修改的文件并筛选 .md 文件
          files=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep '\.md$')
          echo "Modified .md files: $files"

          if [ -n "$files" ]; then
            for file in $files; do
              echo "Processing file: $file"
              # 删除每行末尾的空格
              sed -i 's/ $//g' "$file"
              git add "$file"
            done

            # 提交更改
            git commit -m "Remove trailing spaces from Markdown files"

            # 推送更改
            git push origin $head_branch
          else
            echo "No .md files found or no changes to commit."
          fi
